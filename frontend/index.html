<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAFE-T: Safety Algorithm Fairness Evaluation for Transportation</title>
    <link rel="icon" type="image/png" href="/logo.png">
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f2f2f7;
            color: #1a202c;
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: #0f172a;
            color: white;
            padding: 1.75rem 2rem 1.5rem;
        }

        .header-inner {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header-top {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-logo {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            flex-shrink: 0;
        }

        .header-text h1 {
            font-size: 1.5rem;
            font-weight: 600;
            line-height: 1.3;
        }

        .header-meta {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.25rem;
            font-size: 0.8rem;
            color: rgba(255,255,255,0.4);
        }

        .header-meta span { white-space: nowrap; }

        /* Tabs */
        .tabs-bar {
            background: #ffffff;
            padding: 0 2rem;
            position: sticky;
            top: 0;
            z-index: 1100;
            border-bottom: 2px solid #e5e5ea;
        }

        .tabs-bar-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .tabs {
            display: flex;
            gap: 0.25rem;
        }

        .tab {
            background: transparent;
            color: #718096;
            border: none;
            border-bottom: 2px solid transparent;
            padding: 0.7rem 1.25rem;
            margin-bottom: -2px;
            font-size: 0.9rem;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            transition: color 0.2s, border-bottom-color 0.2s;
            white-space: nowrap;
        }

        .tab:hover {
            color: #2d3748;
        }

        .tab.active {
            color: #0e7490;
            border-bottom-color: #0891b2;
        }

        .test-subtitle {
            font-size: 1.1rem;
            font-weight: 500;
            letter-spacing: -0.01em;
            line-height: 1.5;
            color: white;
            background: linear-gradient(135deg, #0891b2 0%, #0e4a5c 40%, #0f172a 100%);
            padding: 1.15rem 1.5rem;
            border-radius: 10px;
            margin-bottom: 1.75rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .test-subtitle::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #0891b2, transparent 60%);
        }

        .test-subtitle:empty {
            display: none;
        }

        /* Layout */
        .test-content { display: none; }
        .test-content.active { display: block; }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Side-by-side layout */
        .content-split {
            display: grid;
            grid-template-columns: 55fr 45fr;
            gap: 1.5rem;
        }

        .content-split > * {
            min-width: 0;
        }

        .content-map {
            grid-row: 1 / -1;
            position: sticky;
            top: 80px;
            align-self: start;
        }

        .content-map .map-container {
            margin-bottom: 0;
        }

        .content-map .map {
            height: calc(100vh - 240px);
            min-height: 500px;
        }

        .content-split .chart-grid {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        .content-split .chart {
            height: 320px;
        }

        /* Metric Cards */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .metrics-grid:empty {
            display: none;
        }

        .metric-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .metric-card h3 {
            font-size: 0.8rem;
            font-weight: 500;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            margin-bottom: 0.5rem;
        }

        .metric-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: #2d3748;
        }

        .metric-card .value-danger { color: #d32f2f; }
        .metric-card .value-warning { color: #9a6700; }
        .metric-card .value-success { color: #1b7a34; }
        .metric-card .value-info { color: #0e7490; }

        .metric-card .subtext {
            font-size: 0.85rem;
            color: #718096;
            margin-top: 0.25rem;
        }

        /* Charts & Map shared card styles */
        .chart-container,
        .map-container {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .chart-container h2,
        .map-container h2 {
            font-size: 1.15rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #2d3748;
        }

        /* Charts */
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 600px), 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .chart { width: 100%; height: 400px; }

        .chart-header {
            display: flex;
            align-items: baseline;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .chart-header h2 { margin-bottom: 0; }

        .chart-description {
            font-size: 0.9rem;
            color: #4a5568;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        /* Map */
        .map-container {
            margin-bottom: 2rem;
        }

        .map {
            width: 100%;
            height: 500px;
            border-radius: 4px;
        }

        /* Loading */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            font-size: 1.1rem;
            color: #718096;
        }

        /* Key Findings */
        .interpretation {
            background: #f0fdfa;
            border-left: 4px solid #0891b2;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .interpretation h3 {
            font-size: 1.05rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #134e4a;
        }

        .interpretation ul { list-style: none; padding: 0; margin: 0; }

        .interpretation li {
            padding: 0.3rem 0;
            color: #134e4a;
            line-height: 1.6;
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .interpretation li::before {
            content: "\2022";
            font-size: 1.25rem;
            color: #0891b2;
            flex-shrink: 0;
            line-height: 1.4;
        }

        /* Legend */
        .legend {
            background: white;
            padding: 1rem;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            font-size: 0.85rem;
        }

        .legend h4 { font-size: 0.85rem; font-weight: 600; margin-bottom: 0.5rem; }
        .legend-item { display: flex; align-items: center; margin: 0.25rem 0; }
        .legend-color { width: 18px; height: 18px; border-radius: 2px; margin-right: 0.5rem; }

        /* Data Source Badges */
        .data-source-badge {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.2rem 0.6rem;
            background: #f0fdfa;
            border: 1px solid #99f6e4;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            color: #134e4a;
            cursor: help;
        }

        .data-source-badge.simulated {
            background: #fef3c7;
            border-color: #fde68a;
            color: #78350f;
        }

        .data-source-badge.calibrated {
            background: #dbeafe;
            border-color: #93c5fd;
            color: #1e3a5f;
        }

        .data-source-badge.real {
            background: #d1fae5;
            border-color: #a7f3d0;
            color: #065f46;
        }

        .data-source-badge .icon { font-size: 0.8rem; }

        .data-source-badge .tooltip {
            visibility: hidden;
            pointer-events: none;
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 0.5rem;
            width: 280px;
            padding: 0.75rem;
            background: #0f172a;
            color: white;
            font-size: 0.8rem;
            font-weight: 400;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
            line-height: 1.4;
        }

        .data-source-badge .tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #0f172a;
        }

        .data-source-badge:hover .tooltip { visibility: visible; }

        /* Overview Dashboard */
        .overview-banner {
            background: linear-gradient(135deg, #0891b2 0%, #0e4a5c 40%, #0f172a 100%);
            color: white;
            padding: 1.75rem 2rem;
            border-radius: 14px;
            margin-bottom: 1.5rem;
        }

        .overview-banner h2 {
            font-size: 1.35rem;
            font-weight: 700;
            margin-bottom: 0.4rem;
            color: white;
        }

        .overview-banner .banner-description {
            font-size: 0.95rem;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.85);
            margin-bottom: 0.75rem;
        }

        .overview-banner .banner-stats {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .overview-right {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .overview-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .overview-card {
            background: white;
            border: none;
            border-left: 4px solid #0891b2;
            border-radius: 12px;
            padding: 1.25rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            cursor: pointer;
            text-align: left;
            font-family: inherit;
            transition: transform 0.15s ease, box-shadow 0.15s ease;
        }

        .overview-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        .overview-card .card-label {
            font-size: 0.75rem;
            font-weight: 500;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            margin-bottom: 0.35rem;
        }

        .overview-card .card-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: #2d3748;
            line-height: 1.2;
            margin-bottom: 0.35rem;
        }

        .overview-card .card-finding {
            font-size: 0.8rem;
            color: #718096;
            line-height: 1.4;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .content-split {
                grid-template-columns: 1fr;
            }
            .content-map {
                position: static;
                grid-row: auto;
            }
            .content-map .map {
                height: 350px;
                min-height: 0;
            }

            .overview-cards {
                grid-template-columns: 1fr;
            }

            .header { padding: 1.25rem 1rem 1rem; }
            .header-text h1 { font-size: 1.2rem; }
            .header-logo { width: 36px; height: 36px; }

            .tabs-bar { padding: 0 1rem; }
            .tabs-bar-inner { flex-direction: column; align-items: stretch; gap: 0; }
            .tabs { flex-wrap: wrap; gap: 0.25rem; }
            .tab {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
                flex: 1 1 auto;
                min-width: calc(50% - 0.25rem);
                text-align: center;
                border-bottom: none;
                margin-bottom: 0;
            }
            .tab.active {
                background: #f0fdfa;
                border-radius: 6px;
            }
            .container { padding: 1rem; }
            .test-subtitle { font-size: 1rem; padding: 1rem 1.25rem; }
            .overview-banner { padding: 1.25rem; }
            .overview-banner h2 { font-size: 1.15rem; }
            .metrics-grid { grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; }
            .metric-card { padding: 1rem; }
            .metric-card .value { font-size: 1.5rem; }
            .metric-card h3 { font-size: 0.7rem; }
            .metric-card .subtext { font-size: 0.75rem; }

            .chart-grid { gap: 1rem; }
            .chart-container,
            .map-container { padding: 1rem; }
            .chart-container h2,
            .map-container h2 { font-size: 1rem; }
            .chart { height: 300px; }
            .map { height: 350px; }

            .interpretation { padding: 1rem; font-size: 0.9rem; }
            .interpretation h3 { font-size: 1rem; }

            .chart-header { flex-direction: column; align-items: flex-start; gap: 0.5rem; }
            .chart-description { font-size: 0.85rem; }
            .data-source-badge .tooltip { width: 220px; font-size: 0.75rem; }
            .legend { font-size: 0.75rem; padding: 0.75rem; }
            .legend h4 { font-size: 0.75rem; }

            .leaflet-control-zoom { transform: scale(0.9); }
            .leaflet-popup-content { font-size: 0.85rem; }
            .view-toggle-option { font-size: 0.78rem; padding: 0.35rem 0.65rem; }
            body { font-size: 14px; }
        }

        @media (max-width: 480px) {
            .header-text h1 { font-size: 1.05rem; }
            .header-meta { display: none; }
            .tab { font-size: 0.8rem; padding: 0.5rem 0.75rem; }
            .container { padding: 0.75rem; }
            .metrics-grid { grid-template-columns: 1fr; }
            .chart { height: 250px; }
            .map { height: 300px; }
            .metric-card .value { font-size: 1.25rem; }
        }

        /* Footer */
        .site-footer {
            background: #0f172a;
            color: rgba(255, 255, 255, 0.5);
            padding: 1.5rem 2rem;
            font-size: 0.8rem;
            margin-top: 3rem;
        }

        .footer-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .footer-origin {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .footer-origin a {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
        }

        .footer-origin a:hover {
            color: white;
        }

        .footer-team {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem 0;
            align-items: center;
        }

        .footer-team a {
            color: rgba(255, 255, 255, 0.5);
            text-decoration: none;
            transition: color 0.15s;
        }

        .footer-team a:hover {
            color: white;
        }

        .footer-team .separator {
            margin: 0 0.4rem;
            opacity: 0.3;
        }

        .footer-github a {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            color: rgba(255, 255, 255, 0.5);
            text-decoration: none;
            transition: color 0.15s;
        }

        .footer-github a:hover {
            color: white;
        }

        .footer-github svg {
            fill: currentColor;
        }

        @media (max-width: 768px) {
            .site-footer { padding: 1.25rem 1rem; }
            .footer-inner {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }
        }

        /* Utility */
        .chart-container > div[id^="chart-"] { width: 100% !important; }
        .chart-container, .map-container, .metric-card, .interpretation { overflow-wrap: break-word; }
        html { scroll-behavior: smooth; }
        .tab, button, label { -webkit-tap-highlight-color: rgba(0,0,0,0.1); }
        button, .tab, input, label { touch-action: manipulation; }

        /* View Toggle (segmented control) */
        .view-toggle {
            display: inline-flex;
            position: relative;
            background: #e8e8ed;
            border-radius: 8px;
            padding: 3px;
            margin-bottom: 1rem;
        }

        .view-toggle-option {
            position: relative;
            z-index: 1;
            padding: 0.4rem 0.85rem;
            border: none;
            background: transparent;
            font-family: inherit;
            font-size: 0.82rem;
            font-weight: 500;
            color: #636366;
            cursor: pointer;
            border-radius: 6px;
            transition: color 0.15s;
            white-space: nowrap;
        }

        .view-toggle-option.active {
            color: #1a202c;
        }

        .view-toggle-indicator {
            position: absolute;
            top: 3px;
            left: 0;
            height: calc(100% - 6px);
            background: white;
            border-radius: 6px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.08);
            transition: transform 0.2s ease, width 0.2s ease;
            pointer-events: none;
        }

        .tab:focus,
        .tab:focus-visible,
        .overview-card:focus,
        .overview-card:focus-visible,
        .view-toggle-option:focus,
        .view-toggle-option:focus-visible {
            outline: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-inner">
            <div class="header-top">
                <img src="/logo.png" alt="SAFE-T" class="header-logo">
                <div class="header-text">
                    <h1>SAFE-T <span style="font-weight:400;opacity:0.5;">/</span> Safety Algorithm Fairness Evaluation for Transportation</h1>
                    <div class="header-meta">
                        <span>Durham, NC</span>
                        <span>&middot;</span>
                        <span>Census Tract Level</span>
                        <span>&middot;</span>
                        <span>Strava Metro &amp; StreetLight Data</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="tabs-bar">
        <div class="tabs-bar-inner">
            <div class="tabs">
                <button class="tab active" data-test="overview">Overview</button>
                <button class="tab" data-test="test1">Volume Estimation</button>
                <button class="tab" data-test="test2">Crash Prediction</button>
                <button class="tab" data-test="test3">Infrastructure</button>
                <button class="tab" data-test="test4">Suppressed Demand</button>
            </div>
        </div>
    </div>

    <div class="container">
        <p class="test-subtitle" id="test-description"></p>
        <div id="loading" class="loading">Loading data...</div>
        <div id="app" style="display: none;">
            <!-- Overview Content -->
            <div id="overview-content" class="test-content active">
                <div class="overview-banner">
                    <h2>Durham Transportation Equity Audit</h2>
                    <p class="banner-description">AI-powered transportation tools increasingly drive safety budgets, crash predictions, and infrastructure priorities. This audit tests whether those tools treat Durham's communities equitably. Four tests measure how income and race correlate with AI accuracy, resource allocation, and demand visibility.</p>
                    <p class="banner-stats"><span id="tract-count"></span> Tracts &middot; 4 Equity Tests &middot; Real + Simulated Data</p>
                </div>
                <div class="content-split">
                    <div class="content-map">
                        <div class="map-container">
                            <h2>Durham Income Distribution by Census Tract</h2>
                            <p class="chart-description">Median household income across Durham census tracts. The equity tests that follow measure how AI transportation tools treat these areas differently.</p>
                            <div id="overview-map" class="map"></div>
                        </div>
                    </div>
                    <div class="overview-right">
                        <div class="overview-cards" id="overview-cards"></div>
                        <div id="overview-findings"></div>
                    </div>
                </div>
            </div>
            <!-- End Overview Content -->

            <!-- Test 1 Content -->
            <div id="test1-content" class="test-content">
                <div class="metrics-grid" id="metrics"></div>

                <div class="content-split">
                    <div class="content-map">
                        <div class="map-container">
                            <div class="chart-header">
                                <h2>Prediction Error by Census Tract</h2>
                                <span class="data-source-badge simulated">
                                    Simulated
                                    <span class="tooltip">Simulated counter locations with bias patterns from research literature. Real counter data (Strava Metro, StreetLight) requires vendor access.</span>
                                </span>
                            </div>
                            <p class="chart-description">AI volume prediction error across Durham census tracts. Darker red indicates higher prediction errors, concentrated in low-income areas.</p>
                            <div id="map" class="map"></div>
                        </div>
                    </div>

                    <div class="chart-grid">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>Accuracy by Income Quintile</h2>
                                <span class="data-source-badge simulated">
                                    Simulated
                                    <span class="tooltip">Real census demographics (US Census ACS 2022) with simulated volume predictions. Bias model based on documented Strava/StreetLight accuracy disparities.</span>
                                </span>
                            </div>
                            <p class="chart-description">Prediction accuracy across income quintiles (Q1=poorest, Q5=richest). Shows mean absolute error in predicted vs actual pedestrian/cyclist counts.</p>
                            <div id="chart-income" class="chart"></div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>Accuracy by Minority Percentage</h2>
                                <span class="data-source-badge simulated">
                                    Simulated
                                    <span class="tooltip">Racial composition from US Census ACS 2022. Volume predictions simulated with demographic-correlated bias patterns from research literature.</span>
                                </span>
                            </div>
                            <p class="chart-description">Prediction errors grouped by census tract racial composition. Areas with higher minority percentages show systematically worse accuracy.</p>
                            <div id="chart-race" class="chart"></div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>Predicted vs Actual Volume</h2>
                                <span class="data-source-badge simulated">
                                    Simulated
                                    <span class="tooltip">Simulated counter data with demographic-correlated bias. Diagonal line represents perfect prediction; deviations indicate systematic error.</span>
                                </span>
                            </div>
                            <p class="chart-description">Predicted volumes vs actual counts. Perfect predictions follow the diagonal. Systematic deviations reveal where bias occurs.</p>
                            <div id="chart-scatter" class="chart"></div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>Error Distribution</h2>
                                <span class="data-source-badge simulated">
                                    Simulated
                                    <span class="tooltip">Simulated prediction errors across all counter locations. Error model calibrated to documented demographic accuracy gaps in volume estimation tools.</span>
                                </span>
                            </div>
                            <p class="chart-description">Distribution of percentage errors across all counter locations. Positive = overprediction, negative = underprediction.</p>
                            <div id="chart-histogram" class="chart"></div>
                        </div>
                    </div>

                    <div id="interpretation"></div>
                </div>
            </div>
            <!-- End Test 1 Content -->

            <!-- Test 2 Content -->
            <div id="test2-content" class="test-content">
                <div class="metrics-grid" id="test2-metrics"></div>

                <div class="content-split">
                    <div class="content-map">
                        <div class="map-container">
                            <div class="chart-header">
                                <h2>Crash Distribution Map</h2>
                                <span class="data-source-badge calibrated">
                                    Calibrated
                                    <span class="tooltip">Crash volumes calibrated to NCDOT NC Vision Zero totals (~14,400/year). Geographic distribution across tracts is simulated using census demographics.</span>
                                </span>
                            </div>
                            <p class="chart-description">Actual vs predicted crash counts by census tract. Toggle between views to compare.</p>
                            <div class="view-toggle" id="toggle-crash-view">
                                <button class="view-toggle-option active" data-value="actual">Actual</button>
                                <button class="view-toggle-option" data-value="predicted">AI Predicted</button>
                                <div class="view-toggle-indicator"></div>
                            </div>
                            <div id="map-crashes" class="map"></div>
                        </div>
                    </div>

                    <div class="chart-grid">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>Model Performance by Quintile</h2>
                                <span class="data-source-badge calibrated">
                                    Calibrated
                                    <span class="tooltip">Ridge regression trained on NCDOT-calibrated crash data (2019-2022), evaluated on 2023. Real census demographics with simulated geographic distribution.</span>
                                </span>
                            </div>
                            <p class="chart-description">Precision, recall, and F1 scores across income quintiles. Model quality degrades systematically in lower-income tracts.</p>
                            <div id="chart-confusion" class="chart"></div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>Crashes Over Time</h2>
                                <span class="data-source-badge calibrated">
                                    Calibrated
                                    <span class="tooltip">5-year crash trends (2019-2023) with volumes calibrated to NCDOT totals. Year-over-year distribution across tracts is simulated.</span>
                                </span>
                            </div>
                            <p class="chart-description">Actual vs predicted crashes over 5 years. Shows persistent over/underprediction patterns by income level.</p>
                            <div id="chart-timeseries" class="chart"></div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>Classification Accuracy by Quintile</h2>
                                <span class="data-source-badge calibrated">
                                    Calibrated
                                    <span class="tooltip">ROC analysis from Ridge regression on NCDOT-calibrated crash data. AUC measures the model's ability to distinguish high-risk from low-risk tracts per quintile.</span>
                                </span>
                            </div>
                            <p class="chart-description">Ability to distinguish high-risk vs low-risk areas by income level. Lower AUC = worse discrimination, concentrated in poorer quintiles.</p>
                            <div id="chart-roc" class="chart"></div>
                        </div>
                    </div>

                    <div id="test2-interpretation"></div>
                </div>
            </div>
            <!-- End Test 2 Content -->

            <!-- Test 3 Content -->
            <div id="test3-content" class="test-content">
                <div class="metrics-grid" id="test3-metrics"></div>

                <div class="content-split">
                    <div class="content-map">
                        <div class="map-container">
                            <div class="chart-header">
                                <h2>Infrastructure Recommendations Map</h2>
                                <span class="data-source-badge simulated">
                                    Simulated
                                    <span class="tooltip">Simulated safety projects using census demographics and danger scores. AI allocation uses income-correlated bias; need-based allocation uses danger scores alone.</span>
                                </span>
                            </div>
                            <p class="chart-description">Safety project locations from AI vs need-based allocation. Shading shows danger scores; markers show projects. Toggle to compare.</p>
                            <div class="view-toggle" id="toggle-allocation-type">
                                <button class="view-toggle-option active" data-value="ai">AI Allocation</button>
                                <button class="view-toggle-option" data-value="need">Need-Based</button>
                                <div class="view-toggle-indicator"></div>
                            </div>
                            <div id="map-infrastructure" class="map"></div>
                        </div>
                    </div>

                    <div class="chart-grid">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>Budget Allocation by Income</h2>
                                <span class="data-source-badge simulated">
                                        Simulated
                                    <span class="tooltip">$5M budget allocated across income quintiles using two methods: AI-driven (biased by data availability) and need-based (proportional to danger scores).</span>
                                </span>
                            </div>
                            <p class="chart-description">Safety budget distribution across income quintiles. Width represents funding amount. Low-income areas receive disproportionately less.</p>
                            <div id="chart-sankey" class="chart"></div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>Equity Comparison: AI vs Need-Based</h2>
                                <span class="data-source-badge simulated">
                                        Simulated
                                    <span class="tooltip">Equity metrics (disparate impact ratio, Gini coefficient, coverage rate, per-capita spending) comparing AI-driven vs need-based allocation strategies.</span>
                                </span>
                            </div>
                            <p class="chart-description">AI vs need-based allocation across equity metrics. Larger area = better equity. Need-based outperforms AI on every dimension.</p>
                            <div id="chart-radar" class="chart"></div>
                        </div>
                    </div>

                    <div id="test3-interpretation"></div>
                </div>
            </div>
            <!-- End Test 3 Content -->

            <!-- Test 4 Content -->
            <div id="test4-content" class="test-content">
                <div class="metrics-grid" id="test4-metrics"></div>

                <div class="content-split">
                    <div class="content-map">
                        <div class="map-container">
                            <div class="chart-header">
                                <h2>Demand Distribution Map</h2>
                                <span class="data-source-badge simulated">
                                    Simulated
                                    <span class="tooltip">Demand modeled from infrastructure quality, safety perception, and census demographics. Potential demand estimated independent of current infrastructure conditions.</span>
                                </span>
                            </div>
                            <p class="chart-description">Suppressed, potential, and actual cycling/walking demand across Durham. High suppression (red) indicates latent demand AI tools miss.</p>
                            <div class="view-toggle" id="toggle-demand-view">
                                <button class="view-toggle-option active" data-value="suppressed">Suppressed</button>
                                <button class="view-toggle-option" data-value="potential">Potential</button>
                                <button class="view-toggle-option" data-value="actual">Actual</button>
                                <div class="view-toggle-indicator"></div>
                            </div>
                            <div id="map-demand" class="map"></div>
                        </div>
                    </div>

                    <div class="chart-grid">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>Demand Suppression: Q1 vs Q5</h2>
                                <span class="data-source-badge simulated">
                                        Simulated
                                    <span class="tooltip">Funnel comparing potential-to-actual demand conversion in Q1 (poorest) vs Q5 (richest) areas. Suppression modeled from infrastructure quality and safety factors.</span>
                                </span>
                            </div>
                            <p class="chart-description">Demand suppression stages from potential to actual usage. Width represents trip volume at each stage. Q1 areas show severe drop-off.</p>
                            <div id="chart-funnel" class="chart"></div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>AI Detection Capability</h2>
                                <span class="data-source-badge simulated">
                                        Simulated
                                    <span class="tooltip">Three detection approaches compared: naive AI (observed demand only), sophisticated AI (demographics + infrastructure), and human expert baseline.</span>
                                </span>
                            </div>
                            <p class="chart-description">Detection accuracy for suppressed demand. Naive AI fails; sophisticated AI achieves partial detection. Neither matches human expert baseline.</p>
                            <div id="chart-scorecard" class="chart"></div>
                        </div>
                    </div>

                    <div id="test4-interpretation"></div>
                </div>
            </div>
            <!-- End Test 4 Content -->
        </div>
    </div>

    <footer class="site-footer">
        <div class="footer-inner">
            <div class="footer-origin">
                <span>Built at the <a href="https://sites.duke.edu/scai/hackathon/" target="_blank" rel="noopener">2026 SCAI Hackathon</a>, Duke University</span>
                <div class="footer-team">
                    <a href="https://www.linkedin.com/in/jonasnvs/" target="_blank" rel="noopener">Jonas Neves</a>
                    <span class="separator">&middot;</span>
                    <a href="https://www.linkedin.com/in/lindsay-gross1/" target="_blank" rel="noopener">Lindsay Gross</a>
                    <span class="separator">&middot;</span>
                    <a href="https://www.linkedin.com/in/shreya-mendi/" target="_blank" rel="noopener">Shreya Mendi</a>
                    <span class="separator">&middot;</span>
                    <a href="https://www.linkedin.com/in/arnavmahale/" target="_blank" rel="noopener">Arnav Mahale</a>
                    <span class="separator">&middot;</span>
                    <a href="https://www.linkedin.com/in/matthewmenon/" target="_blank" rel="noopener">Matthew Menon</a>
                </div>
            </div>
            <div class="footer-github">
                <a href="https://github.com/safe-t-ai/safe-t-ai.github.io" target="_blank" rel="noopener">
                    <svg width="18" height="18" viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
                    Source Code
                </a>
            </div>
        </div>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script type="module" src="/src/main.js"></script>
</body>
</html>
