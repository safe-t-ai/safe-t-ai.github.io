<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAFE-T: Safety Algorithm Fairness Evaluation for Transportation</title>
    <link rel="icon" type="image/png" href="/logo.png">
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f2f2f7;
            color: #1a202c;
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: #0f172a;
            color: white;
            padding: 1.75rem 2rem 1.5rem;
        }

        .header-inner {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header-top {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-logo {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            flex-shrink: 0;
        }

        .header-text h1 {
            font-size: 1.5rem;
            font-weight: 600;
            line-height: 1.3;
        }

        .header-meta {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.25rem;
            font-size: 0.8rem;
            color: rgba(255,255,255,0.4);
        }

        .header-meta span { white-space: nowrap; }

        /* Tabs */
        .tabs-bar {
            background: #ffffff;
            padding: 0 2rem;
            position: sticky;
            top: 0;
            z-index: 1100;
            border-bottom: 2px solid #e5e5ea;
        }

        .tabs-bar-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .tabs {
            display: flex;
            gap: 0.25rem;
        }

        .tab {
            background: transparent;
            color: #718096;
            border: none;
            border-bottom: 2px solid transparent;
            padding: 0.7rem 1.25rem;
            margin-bottom: -2px;
            font-size: 0.9rem;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            transition: color 0.2s, border-bottom-color 0.2s;
            white-space: nowrap;
        }

        .tab:hover {
            color: #2d3748;
        }

        .tab.active {
            color: #0e7490;
            border-bottom-color: #0891b2;
        }

        .test-subtitle {
            font-size: 1.1rem;
            font-weight: 500;
            letter-spacing: -0.01em;
            line-height: 1.5;
            color: white;
            background: linear-gradient(135deg, #0891b2 0%, #0e4a5c 40%, #0f172a 100%);
            padding: 1.15rem 1.5rem;
            border-radius: 10px;
            margin-bottom: 1.75rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .test-subtitle::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #0891b2, transparent 60%);
        }

        .test-subtitle:empty {
            display: none;
        }

        /* Layout */
        .test-content { display: none; }
        .test-content.active { display: block; }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Side-by-side layout */
        .content-split {
            display: grid;
            grid-template-columns: 55fr 45fr;
            gap: 1.5rem;
        }

        .content-split > * {
            min-width: 0;
        }

        .content-map {
            grid-row: 1 / -1;
            position: sticky;
            top: 80px;
            align-self: start;
        }

        .content-map .map-container {
            margin-bottom: 0;
        }

        .content-map .map {
            height: calc(100vh - 240px);
            min-height: 500px;
        }

        .content-split .chart-grid {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        .content-split .chart {
            height: 320px;
        }

        /* Metric Cards */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .metrics-grid:empty {
            display: none;
        }

        .metric-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .metric-card h3 {
            font-size: 0.8rem;
            font-weight: 500;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            margin-bottom: 0.5rem;
        }

        .metric-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: #2d3748;
        }

        .metric-card .value-danger { color: #d32f2f; }
        .metric-card .value-warning { color: #9a6700; }
        .metric-card .value-success { color: #1b7a34; }
        .metric-card .value-info { color: #0e7490; }

        .metric-card .subtext {
            font-size: 0.85rem;
            color: #718096;
            margin-top: 0.25rem;
        }

        /* Charts & Map shared card styles */
        .chart-container,
        .map-container {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .chart-container h2,
        .map-container h2 {
            font-size: 1.15rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #2d3748;
        }

        /* Charts */
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 600px), 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .chart { width: 100%; height: 400px; }

        .chart-header {
            display: flex;
            align-items: baseline;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .chart-header h2 { margin-bottom: 0; }

        .chart-description {
            font-size: 0.9rem;
            color: #4a5568;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        /* Map */
        .map-container {
            margin-bottom: 2rem;
        }

        .map {
            width: 100%;
            height: 500px;
            border-radius: 4px;
        }

        /* Loading */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            font-size: 1.1rem;
            color: #718096;
        }

        /* Key Findings */
        .interpretation {
            background: #f0fdfa;
            border-left: 4px solid #0891b2;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .interpretation h3 {
            font-size: 1.05rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #134e4a;
        }

        .interpretation ul { list-style: none; padding: 0; margin: 0; }

        .interpretation li {
            padding: 0.3rem 0;
            color: #134e4a;
            line-height: 1.6;
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .interpretation li::before {
            content: "\2022";
            font-size: 1.25rem;
            color: #0891b2;
            flex-shrink: 0;
            line-height: 1.4;
        }

        /* Legend */
        .legend {
            background: white;
            padding: 1rem;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            font-size: 0.85rem;
        }

        .legend h4 { font-size: 0.85rem; font-weight: 600; margin-bottom: 0.5rem; }
        .legend-item { display: flex; align-items: center; margin: 0.25rem 0; }
        .legend-color { width: 18px; height: 18px; border-radius: 2px; margin-right: 0.5rem; }

        /* Data Source Badges */
        .data-source-badge {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.2rem 0.6rem;
            background: #f0fdfa;
            border: 1px solid #99f6e4;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            color: #134e4a;
            cursor: help;
        }

        .data-source-badge.simulated {
            background: #fef3c7;
            border-color: #fde68a;
            color: #78350f;
        }

        .data-source-badge.real {
            background: #d1fae5;
            border-color: #a7f3d0;
            color: #065f46;
        }

        .data-source-badge .icon { font-size: 0.8rem; }

        .data-source-badge .tooltip {
            visibility: hidden;
            pointer-events: none;
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 0.5rem;
            width: 280px;
            padding: 0.75rem;
            background: #0f172a;
            color: white;
            font-size: 0.8rem;
            font-weight: 400;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
            line-height: 1.4;
        }

        .data-source-badge .tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #0f172a;
        }

        .data-source-badge:hover .tooltip { visibility: visible; }

        /* Overview Dashboard */
        .overview-banner {
            background: linear-gradient(135deg, #0891b2 0%, #0e4a5c 40%, #0f172a 100%);
            color: white;
            padding: 1.75rem 2rem;
            border-radius: 14px;
            margin-bottom: 1.5rem;
        }

        .overview-banner h2 {
            font-size: 1.35rem;
            font-weight: 700;
            margin-bottom: 0.4rem;
            color: white;
        }

        .overview-banner .banner-description {
            font-size: 0.95rem;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.85);
            margin-bottom: 0.75rem;
        }

        .overview-banner .banner-stats {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .overview-right {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .overview-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .overview-card {
            background: white;
            border: none;
            border-left: 4px solid #0891b2;
            border-radius: 12px;
            padding: 1.25rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            cursor: pointer;
            text-align: left;
            font-family: inherit;
            transition: transform 0.15s ease, box-shadow 0.15s ease;
        }

        .overview-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        .overview-card .card-label {
            font-size: 0.75rem;
            font-weight: 500;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            margin-bottom: 0.35rem;
        }

        .overview-card .card-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: #2d3748;
            line-height: 1.2;
            margin-bottom: 0.35rem;
        }

        .overview-card .card-finding {
            font-size: 0.8rem;
            color: #718096;
            line-height: 1.4;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .content-split {
                grid-template-columns: 1fr;
            }
            .content-map {
                position: static;
                grid-row: auto;
            }
            .content-map .map {
                height: 350px;
                min-height: 0;
            }

            .overview-cards {
                grid-template-columns: 1fr;
            }

            .header { padding: 1.25rem 1rem 1rem; }
            .header-text h1 { font-size: 1.2rem; }
            .header-logo { width: 36px; height: 36px; }

            .tabs-bar { padding: 0 1rem; }
            .tabs-bar-inner { flex-direction: column; align-items: stretch; gap: 0; }
            .tabs { flex-wrap: wrap; gap: 0.25rem; }
            .tab {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
                flex: 1 1 auto;
                min-width: calc(50% - 0.25rem);
                text-align: center;
                border-bottom: none;
                margin-bottom: 0;
            }
            .tab.active {
                background: #f0fdfa;
                border-radius: 6px;
            }
            .container { padding: 1rem; }
            .test-subtitle { font-size: 1rem; padding: 1rem 1.25rem; }
            .overview-banner { padding: 1.25rem; }
            .overview-banner h2 { font-size: 1.15rem; }
            .metrics-grid { grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; }
            .metric-card { padding: 1rem; }
            .metric-card .value { font-size: 1.5rem; }
            .metric-card h3 { font-size: 0.7rem; }
            .metric-card .subtext { font-size: 0.75rem; }

            .chart-grid { gap: 1rem; }
            .chart-container,
            .map-container { padding: 1rem; }
            .chart-container h2,
            .map-container h2 { font-size: 1rem; }
            .chart { height: 300px; }
            .map { height: 350px; }

            .interpretation { padding: 1rem; font-size: 0.9rem; }
            .interpretation h3 { font-size: 1rem; }

            .chart-header { flex-direction: column; align-items: flex-start; gap: 0.5rem; }
            .chart-description { font-size: 0.85rem; }
            .data-source-badge .tooltip { width: 220px; font-size: 0.75rem; }
            .legend { font-size: 0.75rem; padding: 0.75rem; }
            .legend h4 { font-size: 0.75rem; }

            .leaflet-control-zoom { transform: scale(0.9); }
            .leaflet-popup-content { font-size: 0.85rem; }
            input[type="radio"] { width: 20px; height: 20px; margin-right: 0.5rem; }
            label { display: inline-flex; align-items: center; padding: 0.5rem; cursor: pointer; }
            body { font-size: 14px; }
        }

        @media (max-width: 480px) {
            .header-text h1 { font-size: 1.05rem; }
            .header-meta { display: none; }
            .tab { font-size: 0.8rem; padding: 0.5rem 0.75rem; }
            .container { padding: 0.75rem; }
            .metrics-grid { grid-template-columns: 1fr; }
            .chart { height: 250px; }
            .map { height: 300px; }
            .metric-card .value { font-size: 1.25rem; }
        }

        /* Utility */
        .chart-container > div[id^="chart-"] { width: 100% !important; }
        .chart-container, .map-container, .metric-card, .interpretation { overflow-wrap: break-word; }
        html { scroll-behavior: smooth; }
        .tab, button, label { -webkit-tap-highlight-color: rgba(0,0,0,0.1); }
        button, .tab, input, label { touch-action: manipulation; }

        /* Focus */
        .tab:focus-visible,
        .overview-card:focus-visible {
            outline: 2px solid #0891b2;
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-inner">
            <div class="header-top">
                <img src="/logo.png" alt="SAFE-T" class="header-logo">
                <div class="header-text">
                    <h1>SAFE-T <span style="font-weight:400;opacity:0.5;">/</span> Safety Algorithm Fairness Evaluation for Transportation</h1>
                    <div class="header-meta">
                        <span>Durham, NC</span>
                        <span>&middot;</span>
                        <span>Census Tract Level</span>
                        <span>&middot;</span>
                        <span>Strava Metro &amp; StreetLight Data</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="tabs-bar">
        <div class="tabs-bar-inner">
            <div class="tabs">
                <button class="tab active" data-test="overview">Overview</button>
                <button class="tab" data-test="test1">Volume Estimation</button>
                <button class="tab" data-test="test2">Crash Prediction</button>
                <button class="tab" data-test="test3">Infrastructure</button>
                <button class="tab" data-test="test4">Suppressed Demand</button>
            </div>
        </div>
    </div>

    <div class="container">
        <p class="test-subtitle" id="test-description"></p>
        <div id="loading" class="loading">Loading data...</div>
        <div id="app" style="display: none;">
            <!-- Overview Content -->
            <div id="overview-content" class="test-content active">
                <div class="overview-banner">
                    <h2>Durham Transportation Equity Audit</h2>
                    <p class="banner-description">AI-powered transportation tools increasingly drive safety budgets, crash predictions, and infrastructure priorities. This audit tests whether those tools treat Durham's communities equitably. Four tests measure how income and race correlate with AI accuracy, resource allocation, and demand visibility.</p>
                    <p class="banner-stats">67 Tracts &middot; 4 Equity Tests &middot; Simulated Data</p>
                </div>
                <div class="content-split">
                    <div class="content-map">
                        <div class="map-container">
                            <h2>Durham Income Distribution by Census Tract</h2>
                            <p class="chart-description">Median household income across Durham's 67 census tracts. The equity tests that follow measure how AI transportation tools treat these areas differently.</p>
                            <div id="overview-map" class="map"></div>
                        </div>
                    </div>
                    <div class="overview-right">
                        <div class="overview-cards" id="overview-cards"></div>
                        <div id="overview-findings"></div>
                    </div>
                </div>
            </div>
            <!-- End Overview Content -->

            <!-- Test 1 Content -->
            <div id="test1-content" class="test-content">
                <div class="metrics-grid" id="metrics"></div>

                <div class="content-split">
                    <div class="content-map">
                        <div class="map-container">
                            <div class="chart-header">
                                <h2>Prediction Error by Census Tract</h2>
                                <span class="data-source-badge simulated">
                                    Simulated
                                    <span class="tooltip">Data based on simulated counter locations with documented bias patterns. Real counter data (Strava Metro, StreetLight) requires vendor access.</span>
                                </span>
                            </div>
                            <p class="chart-description">AI volume prediction error across Durham census tracts. Darker red indicates higher prediction errors, concentrated in low-income areas.</p>
                            <div id="map" class="map"></div>
                        </div>
                    </div>

                    <div class="chart-grid">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>Accuracy by Income Quintile</h2>
                                <span class="data-source-badge simulated">
                                    Simulated
                                    <span class="tooltip">Census demographics are real (US Census ACS 2022). Volume predictions are simulated to demonstrate bias patterns documented in research literature.</span>
                                </span>
                            </div>
                            <p class="chart-description">Prediction accuracy across income quintiles (Q1=poorest, Q5=richest). Shows mean absolute error in predicted vs actual pedestrian/cyclist counts.</p>
                            <div id="chart-income" class="chart"></div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>Accuracy by Minority Percentage</h2>
                                <span class="data-source-badge simulated">
                                    Simulated
                                    <span class="tooltip">Racial composition data from US Census ACS 2022. AI predictions simulated with documented bias patterns showing worse accuracy in high-minority areas.</span>
                                </span>
                            </div>
                            <p class="chart-description">Prediction errors grouped by census tract racial composition. Areas with higher minority percentages show systematically worse accuracy.</p>
                            <div id="chart-race" class="chart"></div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>Predicted vs Actual Volume</h2>
                                <span class="data-source-badge simulated">
                                    Simulated
                                    <span class="tooltip">Simulated counter data demonstrating systematic bias. Red line shows AI underprediction in low-income areas and overprediction in high-income areas.</span>
                                </span>
                            </div>
                            <p class="chart-description">Predicted volumes vs actual counts. Perfect predictions follow the diagonal. Systematic deviations reveal where bias occurs.</p>
                            <div id="chart-scatter" class="chart"></div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>Error Distribution</h2>
                                <span class="data-source-badge simulated">
                                    Simulated
                                    <span class="tooltip">Distribution of prediction errors across all counter locations. Simulated to show realistic error patterns with documented demographic bias.</span>
                                </span>
                            </div>
                            <p class="chart-description">Distribution of percentage errors across all counter locations. Positive = overprediction, negative = underprediction.</p>
                            <div id="chart-histogram" class="chart"></div>
                        </div>
                    </div>

                    <div id="interpretation"></div>
                </div>
            </div>
            <!-- End Test 1 Content -->

            <!-- Test 2 Content -->
            <div id="test2-content" class="test-content">
                <div class="metrics-grid" id="test2-metrics"></div>

                <div class="content-split">
                    <div class="content-map">
                        <div class="map-container">
                            <div class="chart-header">
                                <h2>Crash Distribution Map</h2>
                                <span class="data-source-badge simulated">
                                    Simulated
                                    <span class="tooltip">Crash data simulated with realistic distributions based on Durham County demographics and road network characteristics.</span>
                                </span>
                            </div>
                            <p class="chart-description">Actual vs predicted crash counts by census tract. Toggle between views to compare.</p>
                            <div style="margin-bottom: 1rem;">
                                <label style="margin-right: 1rem;">
                                    <input type="radio" name="crash-view" value="actual" checked> Actual Crashes
                                </label>
                                <label>
                                    <input type="radio" name="crash-view" value="predicted"> AI Predicted Crashes
                                </label>
                            </div>
                            <div id="map-crashes" class="map"></div>
                        </div>
                    </div>

                    <div class="chart-grid">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>Model Performance by Quintile</h2>
                                <span class="data-source-badge simulated">
                                    Simulated
                                    <span class="tooltip">AI trained on simulated Durham crash data (2019-2023). Demonstrates documented pattern: AI shows 25-40% higher error rates in low-income areas.</span>
                                </span>
                            </div>
                            <p class="chart-description">Precision, recall, and F1 scores across income quintiles. Model quality degrades systematically in lower-income tracts.</p>
                            <div id="chart-confusion" class="chart"></div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>Crashes Over Time</h2>
                                <span class="data-source-badge simulated">
                                    Simulated
                                    <span class="tooltip">5-year crash trends (2019-2023) simulated with realistic temporal patterns based on Durham County demographics.</span>
                                </span>
                            </div>
                            <p class="chart-description">Actual vs predicted crashes over 5 years. Shows persistent over/underprediction patterns by income level.</p>
                            <div id="chart-timeseries" class="chart"></div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>Classification Accuracy by Quintile</h2>
                                <span class="data-source-badge simulated">
                                    Simulated
                                    <span class="tooltip">ROC analysis using Ridge regression trained on simulated crash data. Demonstrates lower discrimination ability (AUC) for low-income quintiles.</span>
                                </span>
                            </div>
                            <p class="chart-description">Ability to distinguish high-risk vs low-risk areas by income level. Lower AUC = worse discrimination, concentrated in poorer quintiles.</p>
                            <div id="chart-roc" class="chart"></div>
                        </div>
                    </div>

                    <div id="test2-interpretation"></div>
                </div>
            </div>
            <!-- End Test 2 Content -->

            <!-- Test 3 Content -->
            <div id="test3-content" class="test-content">
                <div class="metrics-grid" id="test3-metrics"></div>

                <div class="content-split">
                    <div class="content-map">
                        <div class="map-container">
                            <div class="chart-header">
                                <h2>Infrastructure Recommendations Map</h2>
                                <span class="data-source-badge simulated">
                                    Simulated
                                    <span class="tooltip">Infrastructure recommendations simulated using crash data + census demographics. Demonstrates how AI-driven allocation systematically favors wealthier areas.</span>
                                </span>
                            </div>
                            <p class="chart-description">Safety project locations from AI vs need-based allocation. Shading shows danger scores; markers show projects. Toggle to compare.</p>
                            <div style="margin-bottom: 1rem;">
                                <label style="margin-right: 1rem;">
                                    <input type="radio" name="allocation-type" value="ai" checked> AI Allocation (Biased)
                                </label>
                                <label>
                                    <input type="radio" name="allocation-type" value="need"> Need-Based (Equitable)
                                </label>
                            </div>
                            <div id="map-infrastructure" class="map"></div>
                        </div>
                    </div>

                    <div class="chart-grid">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>Budget Allocation by Income</h2>
                                <span class="data-source-badge simulated">
                                        Simulated
                                    <span class="tooltip">$5M budget allocation simulated across income quintiles. Shows AI allocates 29.5% as much per-capita to Q1 as Q5 (disparate impact).</span>
                                </span>
                            </div>
                            <p class="chart-description">$5M safety budget distribution across income quintiles. Width represents funding amount. Low-income areas receive disproportionately less.</p>
                            <div id="chart-sankey" class="chart"></div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>Equity Comparison: AI vs Need-Based</h2>
                                <span class="data-source-badge simulated">
                                        Simulated
                                    <span class="tooltip">Multi-metric equity comparison: disparate impact, Gini coefficient, coverage rate, and per-capita spending. All metrics show AI allocation is less equitable.</span>
                                </span>
                            </div>
                            <p class="chart-description">AI vs need-based allocation across equity metrics. Larger area = better equity. Need-based outperforms AI on every dimension.</p>
                            <div id="chart-radar" class="chart"></div>
                        </div>
                    </div>

                    <div id="test3-interpretation"></div>
                </div>
            </div>
            <!-- End Test 3 Content -->

            <!-- Test 4 Content -->
            <div id="test4-content" class="test-content">
                <div class="metrics-grid" id="test4-metrics"></div>

                <div class="content-split">
                    <div class="content-map">
                        <div class="map-container">
                            <div class="chart-header">
                                <h2>Demand Distribution Map</h2>
                                <span class="data-source-badge simulated">
                                    Simulated
                                    <span class="tooltip">Demand suppression analysis simulated using infrastructure quality, safety perception, and demographic factors. Shows latent demand invisible to naive AI tools.</span>
                                </span>
                            </div>
                            <p class="chart-description">Suppressed, potential, and actual cycling/walking demand across Durham. High suppression (red) indicates latent demand AI tools miss.</p>
                            <div style="margin-bottom: 1rem;">
                                <label style="margin-right: 1rem;">
                                    <input type="radio" name="demand-view" value="suppressed" checked> Suppressed Demand
                                </label>
                                <label style="margin-right: 1rem;">
                                    <input type="radio" name="demand-view" value="potential"> Potential Demand
                                </label>
                                <label>
                                    <input type="radio" name="demand-view" value="actual"> Actual Demand
                                </label>
                            </div>
                            <div id="map-demand" class="map"></div>
                        </div>
                    </div>

                    <div class="chart-grid">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>Demand Suppression: Q1 vs Q5</h2>
                                <span class="data-source-badge simulated">
                                        Simulated
                                    <span class="tooltip">Funnel analysis comparing potential â†’ actual demand conversion in Q1 (poorest) vs Q5 (richest) areas. Q1 shows 70%+ suppression.</span>
                                </span>
                            </div>
                            <p class="chart-description">Demand suppression stages from potential to actual usage. Width represents trip volume at each stage. Q1 areas show severe drop-off.</p>
                            <div id="chart-funnel" class="chart"></div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h2>AI Detection Capability</h2>
                                <span class="data-source-badge simulated">
                                        Simulated
                                    <span class="tooltip">Scorecard comparing naive AI (actual demand only) vs sophisticated AI (demographics + infrastructure). Even advanced AI misses 30-40% of suppressed demand.</span>
                                </span>
                            </div>
                            <p class="chart-description">Detection accuracy for suppressed demand. Naive AI fails; sophisticated AI achieves partial detection. Neither matches human expert baseline.</p>
                            <div id="chart-scorecard" class="chart"></div>
                        </div>
                    </div>

                    <div id="test4-interpretation"></div>
                </div>
            </div>
            <!-- End Test 4 Content -->
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script type="module" src="/src/main.js"></script>
</body>
</html>
